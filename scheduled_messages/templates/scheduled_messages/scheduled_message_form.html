{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div style="background: #ffeb3b; color: #222; padding: 12px; text-align: center; font-size: 1.2rem; font-weight: bold;">TESTE DE TEMPLATE ATIVO</div>
<style>
.sched-card {
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 2px 16px rgba(0,0,0,0.07);
  max-width: 480px;
  margin: 48px auto;
  padding: 38px 32px 32px 32px;
}
.sched-title {
  font-size: 2rem;
  font-weight: 700;
  color: #1a2947;
  margin-bottom: 18px;
  text-align: left;
}
.sched-upload {
  border: 2px dashed #bcd0e5;
  border-radius: 12px;
  background: #f5faff;
  padding: 32px 12px 18px 12px;
  text-align: center;
  margin-bottom: 18px;
  cursor: pointer;
  transition: border-color 0.2s;
}
.sched-upload:hover {
  border-color: #2196f3;
}
.sched-upload-icon {
  font-size: 2.5rem;
  color: #bcd0e5;
  margin-bottom: 8px;
}
.sched-btn-row {
  display: flex;
  gap: 8px;
  margin-bottom: 18px;
}
.sched-btn-day {
  border: none;
  background: #e3f2fd;
  color: #1976d2;
  font-weight: 600;
  border-radius: 8px;
  width: 36px;
  height: 36px;
  font-size: 1.1rem;
  margin-right: 4px;
  margin-bottom: 4px;
  transition: background 0.2s, color 0.2s;
}
.sched-btn-day.selected, .sched-btn-day:active {
  background: #1976d2;
  color: #fff;
}
.sched-action-row {
  display: flex;
  gap: 10px;
  margin-top: 18px;
}
.sched-btn-main {
  flex: 1;
  font-size: 1.1rem;
  font-weight: 600;
  border-radius: 10px;
  padding: 12px 0;
  border: none;
}
.sched-btn-draft {
  background: #f5f5f5;
  color: #333;
}
.sched-btn-save {
  background: #1abc9c;
  color: #fff;
}
</style>
<div class="sched-card">
  <div class="sched-title">Novo Agendamento</div>
  <form method="post" enctype="multipart/form-data" id="msgForm">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="mb-3">
      {{ form.canal|as_crispy_field }}
    </div>
    <div class="mb-3">
      {{ form.titulo|as_crispy_field }}
    </div>
    <label class="sched-upload" for="id_arquivo">
      <div class="sched-upload-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none" viewBox="0 0 24 24"><path fill="#bcd0e5" d="M12 16a1 1 0 0 1-1-1V8.41l-2.3 2.3a1 1 0 1 1-1.4-1.42l4-4a1 1 0 0 1 1.4 0l4 4a1 1 0 1 1-1.4 1.42L13 8.41V15a1 1 0 0 1-1 1Z"/><path fill="#bcd0e5" d="M20 18a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-2a1 1 0 1 1 2 0v1h12v-1a1 1 0 1 1 2 0v2Z"/></svg>
      </div>
      <div style="color:#7a8ca3; font-size:1.08rem; font-weight:500;">Digite sua mensagem... ou clique para upload</div>
      {{ form.arquivo|as_crispy_field }}
    </label>
    <div class="mb-3">
      <input type="text" name="caption" class="form-control" placeholder="Digite a legenda..." value="{{ form.caption.value|default:'' }}" style="margin-top:8px;">
    </div>
    <div class="mb-3">
      {{ form.texto|as_crispy_field }}
    </div>
    <div class="mb-3">
      <input type="checkbox" id="add_button" name="add_button" style="margin-right:8px;">
      <label for="add_button" style="font-weight:500;">Adicionar botÃ£o ao post</label>
      <div class="sched-btn-row">
        <input type="text" class="form-control" placeholder="TÃ­tulo do botÃ£o" style="flex:1;">
        <input type="text" class="form-control" placeholder="URL do botÃ£o" style="flex:2;">
      </div>
    </div>
    <div class="mb-3">
      {{ form.tipo|as_crispy_field }}
    </div>
    <div class="mb-3">
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span style="font-size:1.3rem; color:#1976d2;">ðŸ•’</span>
        {{ form.horario|as_crispy_field }}
      </div>
      <label style="font-weight:500; margin-bottom:6px;">Dias da semana</label>
      <div class="sched-btn-row">
        {% for value, label in form.dias_semana.field.choices %}
          <label style="margin:0;">
            <input type="checkbox" name="dias_semana" value="{{ value }}" {% if value in form.dias_semana.value %}checked{% endif %} style="display:none;">
            <span class="sched-btn-day {% if value in form.dias_semana.value %}selected{% endif %}">
              {% if value == 'mon' %}Seg{% elif value == 'tue' %}Ter{% elif value == 'wed' %}Qua{% elif value == 'thu' %}Qui{% elif value == 'fri' %}Sex{% elif value == 'sat' %}SÃ¡b{% elif value == 'sun' %}Dom{% endif %}
            </span>
          </label>
        {% endfor %}
      </div>
      <div style="margin-top:10px;">
        <input type="checkbox" id="repetir" name="repetir" checked style="margin-right:8px;">
        <label for="repetir" style="font-weight:500;">Repetir diariamente</label>
      </div>
    </div>
    <div class="mb-3">
      {{ form.data_inicio|as_crispy_field }}
    </div>
    <div class="mb-3">
      {{ form.data_fim|as_crispy_field }}
    </div>
    <div class="sched-action-row">
      <button type="button" class="sched-btn-main sched-btn-draft">Salvar como rascunho</button>
      <button type="submit" class="sched-btn-main sched-btn-save">Agendar</button>
    </div>
  </form>
</div>
<script>
function toggleAgendamento() {
  var tipoRadio = document.querySelector('input[name="tipo"]:checked');
  if (!tipoRadio) return;
  var tipo = tipoRadio.value;
  document.getElementById('agendamento_unico').style.display = tipo === 'unico' ? 'block' : 'none';
  document.getElementById('agendamento_recorrente').style.display = tipo === 'recorrente' ? 'block' : 'none';
}
function toggleDataFim() {
  var cb = document.getElementById('indeterminado');
  var dataFimGroup = document.getElementById('data_fim_group');
  if (cb.checked) {
    dataFimGroup.style.display = 'none';
    document.getElementById('id_data_fim').value = '';
  } else {
    dataFimGroup.style.display = 'block';
  }
}
document.addEventListener('DOMContentLoaded', function() {
  var radios = document.querySelectorAll('input[name="tipo"]');
  var checked = document.querySelector('input[name="tipo"]:checked');
  if (!checked && radios.length > 0) {
    radios[0].checked = true;
  }
  radios.forEach(function(radio) {
    radio.addEventListener('change', toggleAgendamento);
  });
  toggleAgendamento();
  var cb = document.getElementById('indeterminado');
  if (cb) {
    cb.addEventListener('change', toggleDataFim);
    toggleDataFim();
  }
});
</script>
{% endblock %} 